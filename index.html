<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghibli Focus</title>
    <style>
        :root {
            --bg-color: #191919;
            --accent-primary: #7fab7c;
            --accent-secondary: #3E4E37;
            --text-color: #E8E6D9;
            --background-element: #232b23;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Times New Roman", serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            /* Prevent scrollbars in iframe */
        }

        .card {
            width: 90%;
            max-width: 320px;
            text-align: center;
            position: relative;
            z-index: 2;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Ambient Background Animation */
        .ambient-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.25;
            background: url('assets/background.png') center/cover no-repeat;
            animation: breathe 8s infinite ease-in-out;
        }

        @keyframes breathe {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.25;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.15;
            }
        }

        /* Timer Styles */
        .timer-display-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .adjust-btn {
            background: none;
            border: none;
            color: var(--accent-primary);
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.3s;
            padding: 0;
            line-height: 1;
        }

        .adjust-btn:hover {
            opacity: 1;
            text-shadow: 0 0 8px var(--accent-primary);
        }

        .timer-display {
            font-size: 4rem;
            font-weight: normal;
            margin: 0;
            line-height: 1;
            text-shadow: 0 0 10px rgba(127, 171, 124, 0.2);
            min-width: 160px;
            /* Ensure stability */
        }

        .timer-mode {
            font-size: 0.9rem;
            font-style: italic;
            margin-bottom: 10px;
            opacity: 0.8;
            height: 1.2em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            background: transparent;
            border: 1px solid var(--accent-primary);
            color: var(--text-color);
            font-family: inherit;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        button:hover {
            background: var(--accent-primary);
            color: var(--bg-color);
            box-shadow: 0 0 15px rgba(127, 171, 124, 0.4);
        }

        button:active {
            transform: scale(0.95);
        }

        /* Affirmations Styles */
        .affirmation-container {
            background-color: var(--background-element);
            padding: 20px;
            border-radius: 12px;
            position: relative;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border-top: 2px solid var(--accent-secondary);
        }

        .quote-text {
            font-size: 1rem;
            font-style: italic;
            line-height: 1.5;
            margin-bottom: 15px;
            min-height: 60px;
            /* Prevent layout jump */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quote-btn-container {
            display: flex;
            justify-content: center;
        }

        .new-quote-btn {
            font-size: 0.8rem;
            padding: 5px 12px;
            opacity: 0.7;
            border-color: var(--accent-secondary);
        }

        .new-quote-btn:hover {
            opacity: 1;
            background-color: var(--accent-secondary);
            color: var(--text-color);
            border-color: var(--accent-secondary);
        }

        /* SVG Leaf Decor (Optional subtle touch) */
        .leaf-icon {
            width: 20px;
            height: 20px;
            fill: var(--accent-primary);
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
</head>

<body>

    <div class="ambient-bg"></div>

    <div class="card">
        <div class="timer-container">
            <div class="timer-mode" id="timer-mode-text">Focus Time</div>
            <div class="timer-display-container">
                <button class="adjust-btn" id="decrease-time">-</button>
                <div class="timer-display" id="time-display">25:00</div>
                <button class="adjust-btn" id="increase-time">+</button>
            </div>
            <div class="controls">
                <button id="start-btn">Start</button>
                <button id="pause-btn">Pause</button>
                <button id="reset-btn">Reset</button>
            </div>
        </div>

        <div class="affirmation-container">
            <div class="quote-text" id="quote-display">
                "Recipe for success: Study while others are sleeping; work while others are loafing; prepare while
                others are playing; and dream while others are wishing."
            </div>
            <div class="quote-btn-container">
                <button class="new-quote-btn" id="new-quote-btn">
                    <span>&#10022;</span> Inspire Me
                </button>
            </div>
        </div>
    </div>

    <script>
        // === Timer Logic ===
        let WORK_TIME = 25 * 60;
        const BREAK_TIME = 5 * 60;

        let timeLeft = WORK_TIME;
        let isWorkMode = true;
        let timerInterval = null;
        let isRunning = false;

        const timeDisplay = document.getElementById('time-display');
        const modeDisplay = document.getElementById('timer-mode-text');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const incBtn = document.getElementById('increase-time');
        const decBtn = document.getElementById('decrease-time');

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        function updateDisplay() {
            timeDisplay.textContent = formatTime(timeLeft);
            document.title = `${formatTime(timeLeft)} - Ghibli Focus`;
        }

        function updateAdjustButtons() {
            // Hide buttons if running or in break mode (optional decision, let's keep it simple: visible when !isRunning and isWorkMode?)
            // For flexibility, let's allow adjustment when paused/stopped in work mode.
            const show = !isRunning && isWorkMode;
            incBtn.style.visibility = show ? 'visible' : 'hidden';
            decBtn.style.visibility = show ? 'visible' : 'hidden';
        }

        // Adjust Time Logic
        incBtn.addEventListener('click', () => {
            if (!isRunning && isWorkMode) {
                WORK_TIME += 60;
                if (WORK_TIME > 60 * 60) WORK_TIME = 60 * 60; // Max 60m
                timeLeft = WORK_TIME;
                updateDisplay();
            }
        });

        decBtn.addEventListener('click', () => {
            if (!isRunning && isWorkMode) {
                WORK_TIME -= 60;
                if (WORK_TIME < 1 * 60) WORK_TIME = 1 * 60; // Min 1m
                timeLeft = WORK_TIME;
                updateDisplay();
            }
        });

        function switchMode() {
            isWorkMode = !isWorkMode;
            timeLeft = isWorkMode ? WORK_TIME : BREAK_TIME;
            modeDisplay.textContent = isWorkMode ? "Focus Time" : "Break Time";
            updateDisplay();
            updateAdjustButtons();
            playBell();
        }

        function startTimer() {
            if (isRunning) return;

            // Audio Context Resume
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            isRunning = true;
            startBtn.style.opacity = '0.5';
            startBtn.disabled = true;
            updateAdjustButtons();

            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay();
                } else {
                    clearInterval(timerInterval);
                    isRunning = false;
                    startBtn.style.opacity = '1';
                    startBtn.disabled = false;
                    switchMode();
                    startTimer();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!isRunning) return;
            clearInterval(timerInterval);
            isRunning = false;
            startBtn.style.opacity = '1';
            startBtn.disabled = false;
            updateAdjustButtons();
        }

        function resetTimer() {
            pauseTimer();
            isWorkMode = true;
            timeLeft = WORK_TIME;
            modeDisplay.textContent = "Focus Time";
            updateDisplay();
            updateAdjustButtons();
        }

        startBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resetBtn.addEventListener('click', resetTimer);

        // === Audio Logic (Web Audio API) ===
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playBell() {
            // Simple synth bell
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            // Bell-like parameters
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(523.25, audioCtx.currentTime + 1);

            // Envelope
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.05); // Attack
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2.5); // Decay

            osc.start();
            osc.stop(audioCtx.currentTime + 3);

            // Add a harmonic for richness
            const osc2 = audioCtx.createOscillator();
            const gainNode2 = audioCtx.createGain();
            osc2.connect(gainNode2);
            gainNode2.connect(audioCtx.destination);
            osc2.type = 'sine';
            osc2.frequency.setValueAtTime(1046.50, audioCtx.currentTime); // C6
            gainNode2.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode2.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 0.05);
            gainNode2.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2.0);
            osc2.start();
            osc2.stop(audioCtx.currentTime + 3);
        }


        // === Affirmations Logic ===
        const quotes = [
            "Recipe for success: Study while others are sleeping; work while others are loafing; prepare while others are playing; and dream while others are wishing.",
            "It's not really important what color your dress is. What matters is the heart inside. \u2014 Kiki's Delivery Service",
            "You cannot change fate. However, you can rise to meet it. \u2014 Princess Mononoke",
            "Always believe in yourself. Do this and no matter where you are, you will have nothing to fear. \u2014 The Cat Returns",
            "Once you've met someone you never really forget them. \u2014 Spirited Away",
            "Just follow your heart, and keep smiling. \u2014 Kiki's Delivery Service"
        ];

        const quoteDisplay = document.getElementById('quote-display');
        const newQuoteBtn = document.getElementById('new-quote-btn');
        let quoteIndex = 0;

        newQuoteBtn.addEventListener('click', () => {
            // Fade out
            quoteDisplay.style.opacity = 0;

            setTimeout(() => {
                // Change text
                quoteIndex = (quoteIndex + 1) % quotes.length;
                quoteDisplay.textContent = quotes[quoteIndex];
                // Fade in
                quoteDisplay.style.transition = 'opacity 0.5s ease';
                quoteDisplay.style.opacity = 1;
            }, 300);
        });

    </script>
</body>

</html>